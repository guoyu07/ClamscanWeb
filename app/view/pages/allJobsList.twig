{% extends "/layouts/" ~ layout ~ ".twig" %}

{% block pageTitle %}ClamAV Web - View All Jobs{% endblock %}

{% block content %}
    {% if showMassScheduled %}
        <h2>All Mass Scheduled ClamAV Jobs</h2>
    {% else %}
        <h2>All Manually Scheduled ClamAV Jobs</h2>
    {% endif %}
    
    <table id="results" class="table table-striped table-hover table-condensed">
        <thead>
            <tr>
                <th class="sorter-false filter-false"></th>
                <th>State</th>
                <th>Added By</th>
                <th>Added At</th>
                <th>User</th>
                <th>Infected</th>
            </tr>
        </thead>
        {% for job in jobs %}
            {%if job.massScheduled == showMassScheduled %}
                <tr class="
                {% if job.state == "waiting" %}
                    info
                {% elseif job.state == "running" %}
                    warning
                {% elseif job.state == "failed" %}
                    danger
                {% elseif job.state == "finished" %}
                    success
                {% endif %}
                ">
                    <td>
                        <a href="{{ path("getJob", {jobid: job.id}) }}">
                            <span class="glyphicon glyphicon-folder-open"></span>
                        </a>
                    </td>
                    <td>{{ job.state }}</td>
                    <td>{{ job.addedBy }}</td>
                    <td>{{ job.addedAt|date }}</td>
                    <td>{{ job.username }}</td>
                    <td>{{ job.result.infectedFiles }}</td>
                </tr>
            {% endif %}
        {% endfor %}
    </table>
{% endblock %}

{% block extraJavascript %}
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jquery.tablesorter/2.23.0/css/theme.bootstrap.min.css">
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery.tablesorter/2.23.0/js/jquery.tablesorter.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery.tablesorter/2.23.0/js/jquery.tablesorter.widgets.min.js"></script>
    <script type="text/javascript">
        $(function(){
            $.tablesorter.themes.bootstrap = {
                table : "table-sortable",
                iconSortNone: "fa fa-sort",
                iconSortAsc: "fa fa-sort-asc",
                iconSortDesc: "fa fa-sort-desc",
            };
            
            $("#results").tablesorter({
                theme : "bootstrap",
                widthFixed: true,
                headerTemplate : "{content} {icon}",
                widgets: [ "uitheme", "filter", "zebra"],
                widgetOptions : {
                    zebra : [ "even", "odd" ],
                    filter_reset : ".reset"
                },
                sortList: [[3,1],[5,1]]
            });
        });
    </script>
{% endblock %}